// ----------------------------------------------------------------------------------------- //
//         Sitecore Install Framework - Install Commerce Marketing Automation module         //
//                                                                                           //
//  Run this configuration to install Commerce Marketing Automation module.                  //
//                                                                                           //
//  NOTE: Only single line comments are accepted in configurations.                          //
// ----------------------------------------------------------------------------------------- //
{
  "Parameters": {
    "XConnectSitePath": {
      "Type": "string",
      "Description": "The path to the XConnect web site."
    },
    "ModuleFullPath": {
      "Type": "string",
      "Description": "The path to the Commerce Marketing Automation scwdp."
    },
    "SharedConfigurationFolder": {
      "Type": "string",
      "Description": "The base folder where shared configurations are stored"
    },
    "AutomationEngineModule": {
      "Type": "string",
      "Description": "The path to the Commerce Automation Engine zip."
    },
    "SiteName": {
      "Type": "string"
    },
    "SqlDbPrefix": {
      "Type": "string"
    },
    "SqlAdminUser": {
      "Type": "string"
    },
    "SqlAdminPassword": {
      "Type": "string"
    },
    "SqlServer": {
      "Type": "string"
    }
  },
  "Register": {
    "Tasks": {
      "InstallSitecoreModule": "Install-SitecoreConfiguration",
      "ExpandArchive": "Expand-Archive"
    }
  },
  "Tasks": {
    "CheckPaths": {
      "Type": "EnsurePath",
      "Params": {
        "Exists": [
          "[parameter('ModuleFullPath')]"
        ]
      }
    },
    "InstallCommerceMAModule": {
      "Type": "InstallSitecoreModule",
      "Params": {
        "Path": "[concat(parameter('SharedConfigurationFolder'), '\\install-module.json')]",
        "Package": "[parameter('ModuleFullPath')]",
        "SiteName": "[parameter('SiteName')]",
        "DatabasePrefix": "[parameter('SqlDbPrefix')]",
        "SqlAdminUser": "[parameter('SqlAdminUser')]",
        "SqlAdminPassword": "[parameter('SqlAdminPassword')]",
        "SqlServer": "[parameter('SqlServer')]",
        "ModuleDatabase": "master"
      }
    },
    "InstallAutomationEngineModule": {
      "Type": "ExpandArchive",
      "Params": {
        "Path": "[parameter('AutomationEngineModule')]",
        "DestinationPath": "[parameter('XConnectSitePath')]",
        "Force": true
      }
    }
  }
}